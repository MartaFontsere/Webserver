http {
    # --- SERVIDOR PRINCIPAL (localhost) ---
    server {
        listen 8080;
        server_name localhost;
        root ./www;
        index index.html;
        client_max_body_size 100; # Límite de 100 bytes para probar el error 413

        # Página de error personalizada para todo este servidor
        error_page 404 /custom_404.html;

        # Configuración para la raíz
        location / {
            allow_methods GET POST DELETE HEAD;
            autoindex on;
        }

        # --- CASOS DE AUTOINDEX (para test-autoindex.sh) ---
        
        # 1. Directorio con autoindex ON (heredado de /)
        location /tests/files {
            allow_methods GET HEAD;
            autoindex on;
        }

        # 2. Directorio con index.html (debe mostrar el index, no el autoindex)
        location /tests/public {
            allow_methods GET HEAD;
            index index.html;
            autoindex on;
        }

        # 3. Directorio con autoindex OFF
        location /tests/private {
            allow_methods GET HEAD;
            autoindex off;
        }

        # --- CASOS DE POST/DELETE (para test-post-delete.sh) ---

        # Ruta para subir archivos (unificada bajo /tests)
        location /tests/uploads {
            allow_methods POST;
            upload_path ./www/tests/uploads;
        }

        # Carpeta específica para pruebas de DELETE
        location /tests/post-delete {
            allow_methods GET POST DELETE HEAD;
            upload_path ./www/tests/post-delete;
        }

        # --- OTRAS PRUEBAS ---

        # Prueba de Redirección (301 Moved Permanently)
        location /google {
            return 301 http://www.google.com;
        }

        # Configuración de CGI
        location /cgi-bin {
            allow_methods GET POST HEAD;
            cgi_ext .py .php .sh;
            cgi_path /usr/bin/python3 /usr/bin/php /bin/bash;
        }

        # Prueba de ALIAS (Sustituye la ruta, no la concatena)
        location /test-alias {
            alias ./tests/test_assets/;
            index form.html;
        }
    }

    # --- SERVIDOR VIRTUAL (marta.com) ---
    # Comparte el puerto 8080, pero sirve contenido distinto
    server {
        listen 8080;
        server_name marta.com;
        root ./tests/test_assets;
        index hello.php;

        location / {
            allow_methods GET;
        }
    }

    # --- SERVIDOR EN OTRO PUERTO (9999) ---
    server {
        listen 9999;
        server_name localhost;
        root ./www;
        index index.html;

        location / {
            allow_methods GET;
        }
    }
}
